# دليل نظام إدارة المغسلة - الحسيني كلين

## 1. مقدمة عامة

نظام إدارة المغسلة "الحسيني كلين" هو تطبيق ويب شامل مصمم لإدارة أعمال المغاسل والتنظيف. يهدف النظام إلى تسهيل عمليات تتبع الطلبات، إدارة الخدمات، متابعة الأرباح، وإنشاء التقارير المالية.

### الهدف من النظام:
- إدارة طلبات العملاء بكفاءة
- تتبع حالة الطلبات من الاستلام إلى التسليم
- حساب الأرباح والعمولات تلقائياً
- إنشاء تقارير مالية شاملة
- دعم اللغتين العربية والإنجليزية

### المستخدمون المستهدفون:
- مدراء المغاسل
- الموظفين الإداريين
- محاسبي المبيعات

## 2. هيكل المشروع

### الملفات الرئيسية:

#### `app.py`
- الملف الرئيسي لإعدادات التطبيق
- يحتوي على إعدادات قاعدة البيانات والأمان
- يدير نظام تسجيل الدخول والخروج

#### `routes.py`
- يحتوي على جميع المسارات والوظائف
- يدير الصفحات الرئيسية مثل لوحة التحكم والتقارير
- يتعامل مع API للتطبيق المحمول

#### `models.py`
- يحتوي على هيكل قاعدة البيانات
- يعرف جداول: المستخدمين، الطلبات، الفئات، عناصر الطلبات
- يحتوي على وظائف حساب الأرباح والعمولات

#### `config.py`
- إعدادات النظام الرئيسية
- كلمة المرور الإدارية
- إعدادات رفع الملفات

#### `analytics.py`
- محرك التحليلات والتقارير
- حساب الإحصائيات اليومية والشهرية
- إنشاء بيانات الرسوم البيانية

### المجلدات:

#### `templates/`
- `base.html`: القالب الأساسي
- `dashboard.html`: لوحة التحكم الرئيسية
- `orders.html`: صفحة إدارة الطلبات
- `categories.html`: صفحة إدارة الفئات والخدمات
- `analytics.html`: صفحة التحليلات والرسوم البيانية
- `reports.html`: صفحة التقارير والتصدير
- `login.html`: صفحة تسجيل الدخول

#### `static/`
- `css/style.css`: تنسيقات النظام وألوان الثيم
- `js/dashboard.js`: وظائف لوحة التحكم التفاعلية
- `js/analytics.js`: وظائف الرسوم البيانية والتحليلات
- `images/`: صور النظام الافتراضية
- `uploads/`: صور الفئات التي يرفعها المستخدم

## 3. نظام الدخول

### تسجيل الدخول:
1. انتقل إلى الصفحة الرئيسية للنظام
2. أدخل كلمة المرور الإدارية
3. اضغط على "تسجيل الدخول"

### كلمة المرور الافتراضية:
- كلمة المرور: `sasa_ot123`
- يمكن تغييرها من ملف `config.py`

### تغيير كلمة المرور:
1. افتح ملف `config.py`
2. ابحث عن السطر: `ADMIN_SECRET = "sasa_ot123"`
3. غير كلمة المرور بين العلامات
4. احفظ الملف وأعد تشغيل النظام

### تسجيل الخروج:
- اضغط على زر "تسجيل الخروج" في شريط التنقل العلوي

### الأمان:
- النظام محمي بكلمة مرور واحدة للإدارة
- لا يمكن الوصول لأي صفحة بدون تسجيل دخول
- الجلسة تنتهي عند إغلاق المتصفح

## 4. قاعدة البيانات

### نوع قاعدة البيانات:
- PostgreSQL (قاعدة بيانات علائقية قوية)
- تدعم الاستعلامات المعقدة والتحليلات

### الجداول الرئيسية:

#### جدول `users` (المستخدمين):
- `id`: المعرف الفريد
- `name`: اسم العميل
- `phone`: رقم الهاتف
- `latitude`, `longitude`: الموقع الجغرافي
- `created_at`: تاريخ التسجيل

#### جدول `orders` (الطلبات):
- `id`: رقم الطلب
- `user_id`: معرف العميل
- `payment_method`: طريقة الدفع (نقدي، كارت، محفظة)
- `status`: حالة الطلب (في الانتظار، قيد الغسيل، جاهز، تم التسليم)
- `total_amount`: إجمالي المبلغ
- `app_commission`: عمولة التطبيق (30%)
- `shop_revenue`: أرباح المغسلة (70%)

#### جدول `categories` (الفئات):
- `id`: معرف الفئة
- `name_en`, `name_ar`: اسم الفئة بالإنجليزية والعربية
- `description_en`, `description_ar`: وصف الفئة
- `image`: صورة الفئة
- `items`: قائمة الخدمات (JSON)

#### جدول `order_items` (عناصر الطلبات):
- `id`: معرف العنصر
- `order_id`: رقم الطلب
- `category_id`: معرف الفئة
- `item_name_en`, `item_name_ar`: اسم الخدمة
- `quantity`: الكمية
- `unit_price`: سعر الوحدة

### العلاقات بين الجداول:
- علاقة واحد لأكثر بين المستخدمين والطلبات
- علاقة واحد لأكثر بين الطلبات وعناصر الطلبات
- علاقة واحد لأكثر بين الفئات وعناصر الطلبات

## 5. إدارة الفئات والخدمات

### الوصول إلى صفحة الفئات:
1. من لوحة التحكم اضغط على "الفئات"
2. ستظهر قائمة بجميع الفئات الموجودة

### إضافة فئة جديدة:
1. اضغط على "إضافة فئة جديدة"
2. املأ البيانات:
   - الاسم بالإنجليزية
   - الاسم بالعربية
   - الوصف بالإنجليزية
   - الوصف بالعربية
3. ارفع صورة للفئة (اختياري)
4. اضغط "حفظ"

### تعديل فئة موجودة:
1. اضغط على زر "تعديل" بجانب الفئة
2. غير البيانات المطلوبة
3. اضغط "حفظ التغييرات"

### حذف فئة:
1. اضغط على زر "حذف" بجانب الفئة
2. أكد الحذف في النافذة المنبثقة

### إدارة الخدمات داخل الفئة:
1. اضغط على "إدارة الخدمات" للفئة
2. لإضافة خدمة جديدة:
   - اضغط "إضافة خدمة"
   - أدخل الاسم بالعربية والإنجليزية
   - أدخل السعر بالجنيه المصري
   - اضغط "إضافة"
3. لحذف خدمة: اضغط على زر "حذف" بجانب الخدمة

### رفع الصور:
- الصور المدعومة: JPG, PNG, GIF
- الحد الأقصى للحجم: 16 ميجابايت
- يتم حفظ الصور في مجلد `static/uploads/`

## 6. إنشاء وتتبع الطلبات

### إنشاء طلب جديد:
الطلبات تُنشأ من خلال التطبيق المحمول أو API، لكن يمكن متابعتها من لوحة التحكم.

### حالات الطلب:
1. **في الانتظار (Pending)**: طلب جديد لم يبدأ معالجته
2. **قيد الغسيل (Washing)**: الطلب قيد التنفيذ
3. **جاهز (Ready)**: الطلب جاهز للاستلام
4. **تم التسليم (Delivered)**: تم تسليم الطلب للعميل

### تتبع الطلبات:
1. من لوحة التحكم اضغط على "الطلبات"
2. ستظهر قائمة بجميع الطلبات مع تفاصيلها
3. يمكن رؤية:
   - رقم الطلب
   - اسم العميل
   - رقم الهاتف
   - الحالة الحالية
   - إجمالي المبلغ
   - طريقة الدفع
   - تاريخ الطلب

### تحديث حالة الطلب:
1. اضغط على زر "تحديث الحالة" بجانب الطلب
2. اختر الحالة الجديدة من القائمة
3. اضغط "حفظ"

### عرض تفاصيل الطلب:
1. اضغط على رقم الطلب
2. ستظهر نافذة بالتفاصيل:
   - معلومات العميل
   - قائمة الخدمات المطلوبة
   - الكميات والأسعار
   - إجمالي المبلغ
   - تفاصيل الأرباح والعمولات

## 7. التقارير والتحليلات

### الوصول إلى التقارير:
1. من لوحة التحكم اضغط على "التقارير"
2. ستظهر صفحة التقارير الشاملة

### أنواع التقارير:

#### 1. التقرير اليومي:
- إجمالي الطلبات
- إجمالي الأرباح
- عمولة التطبيق (30%)
- أرباح المغسلة (70%)

#### 2. تقرير الطلبات:
- قائمة مفصلة بجميع الطلبات
- يشمل: التاريخ، العميل، الخدمات، المبلغ، الحالة

#### 3. تقرير طرق الدفع:
- توزيع الطلبات حسب طريقة الدفع
- نقدي، كارت، محفظة إلكترونية

#### 4. تقرير الخدمات الأكثر طلباً:
- قائمة بالخدمات حسب شعبيتها
- عدد مرات الطلب لكل خدمة

### التصفية والبحث:
- يمكن تصفية التقارير حسب:
  - التاريخ (من - إلى)
  - حالة الطلب
  - طريقة الدفع
  - العميل

### تصدير التقارير:
1. اضغط على "تصدير إلى CSV"
2. سيتم تحميل ملف Excel يحتوي على:
   - جميع بيانات الطلبات
   - دعم للغة العربية
   - تنسيق جاهز للطباعة

### الرسوم البيانية:
- رسم بياني للأرباح اليومية
- رسم دائري لتوزيع طرق الدفع
- رسم بياني لشعبية الخدمات

## 8. دعم اللغة

### التبديل بين اللغات:
1. في الجانب العلوي الأيمن من الصفحة
2. اضغط على زر "العربية" أو "English"
3. ستتغير واجهة النظام فوراً

### اللغات المدعومة:
- العربية (مع دعم RTL)
- الإنجليزية (LTR)

### دعم RTL:
- النظام يدعم اتجاه الكتابة من اليمين لليسار
- يتم تغيير اتجاه القوائم والنصوص تلقائياً
- الأزرار والعناصر تعكس موقعها

### إضافة ترجمات جديدة:
1. في ملف `dashboard.js` ابحث عن `updateLanguageContent`
2. أضف الترجمات الجديدة في الكود
3. احفظ الملف وأعد تحميل الصفحة

## 9. واجهة المستخدم

### لوحة التحكم الرئيسية:
تحتوي على:
- إحصائيات سريعة (عدد الطلبات، الأرباح اليومية)
- قائمة بأحدث الطلبات
- روابط سريعة للصفحات الرئيسية

### شريط التنقل:
- الشعار واسم النظام
- روابط الصفحات الرئيسية
- زر تبديل اللغة
- زر تبديل الثيم (فاتح/داكن)
- زر تسجيل الخروج

### البطاقات الإحصائية:
- بطاقة الطلبات اليومية (لون أزرق)
- بطاقة الأرباح اليومية (لون أخضر)
- بطاقة العمولة (لون أصفر)
- بطاقة أرباح المغسلة (لون رمادي)

### الأزرار ووظائفها:
- **إضافة جديد**: لإضافة عنصر جديد
- **تعديل**: لتحرير عنصر موجود
- **حذف**: لحذف عنصر
- **عرض التفاصيل**: لإظهار معلومات أكثر
- **تصدير**: لتحميل التقارير

### الثيم المظلم:
- يمكن تفعيله من زر الثيم في الأعلى
- يحفظ الإعداد في المتصفح
- يغير ألوان جميع العناصر

## 10. تخصيص الهوية

### الاسم الحالي:
- اسم النظام: "الحسيني كلين"
- يظهر في شريط التنقل والعنوان

### تغيير اسم النظام:
1. افتح ملف `templates/base.html`
2. ابحث عن "الحسيني كلين"
3. غير الاسم في جميع الأماكن
4. احفظ الملف

### تغيير الشعار:
1. ضع الشعار الجديد في مجلد `static/images/`
2. في ملف `base.html` غير مسار الصورة
3. احفظ الملف

### تغيير العملة:
1. في ملفات الـ JavaScript ابحث عن "LE"
2. غير رمز العملة للعملة المطلوبة
3. في ملف `style.css` يمكن تعديل التنسيق

### تغيير نسبة العمولة:
1. في ملف `models.py` ابحث عن `calculate_totals`
2. غير القيم:
   - `self.app_commission = self.total_amount * 0.30`
   - `self.shop_revenue = self.total_amount * 0.70`
3. احفظ الملف وأعد تشغيل النظام

### تخصيص الألوان:
1. في ملف `static/css/style.css`
2. في بداية الملف تجد متغيرات الألوان
3. غير القيم حسب الهوية المطلوبة

## 11. خطوات التعامل مع الأعطال

### إذا تعطل النظام:
1. تأكد من تشغيل الخادم
2. تحقق من اتصال قاعدة البيانات
3. راجع رسائل الخطأ في وحدة التحكم
4. أعد تشغيل التطبيق

### إذا لم تظهر البيانات:
1. تأكد من وجود بيانات في قاعدة البيانات
2. تحقق من الاتصال بقاعدة البيانات
3. راجع إعدادات `DATABASE_URL` في متغيرات البيئة

### إذا فشل التصدير:
1. تأكد من صحة بيانات التاريخ
2. تحقق من وجود بيانات للفترة المحددة
3. جرب تصدير فترة زمنية أقصر

### إذا تعذر الوصول للوحة التحكم:
1. تأكد من كلمة المرور الصحيحة
2. امسح ملفات الكوكيز من المتصفح
3. تأكد من إعداد `SESSION_SECRET` في البيئة

### رسائل الخطأ الشائعة:
- **Database connection failed**: مشكلة في قاعدة البيانات
- **Invalid password**: كلمة مرور خاطئة
- **Session expired**: انتهت صلاحية الجلسة
- **File upload failed**: فشل رفع الملف

### استكشاف الأخطاء:
1. افتح أدوات المطور في المتصفح (F12)
2. تحقق من رسائل الخطأ في وحدة التحكم
3. راجع سجلات الخادم
4. تأكد من صحة إعدادات قاعدة البيانات

## 12. التطوير المستقبلي المقترح

### إضافة نظام تقييم العملاء:
- إضافة جدول للتقييمات في قاعدة البيانات
- واجهة لعرض التقييمات والتعليقات
- نظام نجوم للتقييم

### إشعارات SMS:
- دمج خدمة Twilio أو مشابهة
- إرسال إشعارات تلقائية عند تغيير حالة الطلب
- تذكير العملاء بموعد الاستلام

### دمج طرق دفع إلكترونية:
- ربط بوابة دفع مثل PayPal أو فوري
- دعم البطاقات الائتمانية
- محفظة إلكترونية داخل النظام

### ربط بتطبيق الموبايل:
- تطوير تطبيق للعملاء على الهواتف
- واجهة برمجة تطبيقات (API) محسنة
- نظام إشعارات push

### تحسينات إضافية:
- نظام مواعيد للتسليم والاستلام
- خرائط تفاعلية لمواقع العملاء
- نظام الولاء والنقاط
- تقارير تحليلية متقدمة
- دعم عملات متعددة
- نظام الخصومات والعروض

### الأمان والحماية:
- تشفير كلمات المرور
- نظام صلاحيات متعدد المستويات
- تسجيل عمليات المستخدمين
- نسخ احتياطية تلقائية

---

هذا الدليل يوفر معلومات شاملة حول استخدام وإدارة نظام المغسلة. في حالة وجود أي استفسارات أو مشاكل تقنية، يرجى مراجعة هذا الدليل أو الاتصال بالدعم التقني.

**آخر تحديث**: يوليو 2025
**الإصدار**: 2.0
**المطور**: نظام الحسيني كلين